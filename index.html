<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>红发会：侦探演绎模拟器</title>
    <style>
        /* 1. 基础布局：适配不同高度的屏幕 */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            background-color: #1a1512; color: #d1c4b1; 
            font-family: "Georgia", "Times New Roman", "SimSun", serif; 
            margin: 0; padding: 0; 
            height: 100vh; width: 100vw;
            display: flex; justify-content: center; align-items: center; 
            overflow: hidden; 
        }

        /* 2. 主容器：在手机上宽度占满，在电脑上保持比例 */
        #game-container { 
            width: 95%; max-width: 850px; 
            height: 96vh; /* 针对手机浏览器地址栏优化的动态高度 */
            border: 3px solid #5d4037; background-color: #2c241e; 
            display: flex; flex-direction: column; 
            padding: 15px; 
            box-shadow: 0 0 40px rgba(0,0,0,0.9);
            position: relative;
        }

        /* 标题适配 */
        h1 { 
            font-size: 1.4rem; color: #ffd700; text-align: center; 
            margin: 0 0 8px 0; border-bottom: 2px solid #5d4037; 
            padding-bottom: 8px; letter-spacing: 3px; 
        }

        .status-bar { 
            display: flex; justify-content: space-between; 
            font-size: 0.75rem; color: #8d6e63; margin-bottom: 12px; 
        }

        /* 3. 内容区：自动适配文本长度 */
        #content-wrapper { flex: 1; display: flex; flex-direction: column; min-height: 0; justify-content: center; }
        
        .text-panel { 
            background: rgba(0,0,0,0.4); padding: 15px; border: 1px solid #3d3329; 
            line-height: 1.6; margin-bottom: 15px; font-size: 1rem; color: #eaddca;
            overflow-y: auto; /* 文本过长时允许区域内滚动 */
        }

        /* 按钮组：默认两列，手机端自动变单列 */
        .choices-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        button { 
            background: #3d3329; color: #d1c4b1; border: 1px solid #5d4037; 
            padding: 12px 8px; cursor: pointer; font-size: 0.9rem; 
            transition: 0.2s; font-family: inherit;
            display: flex; align-items: center; justify-content: center; text-align: center;
        }
        button:hover:not(:disabled) { background: #5d4037; color: #ffd700; border-color: #ffd700; }

        /* 4. 结案展示页：移动端居中对齐 */
        #result-page { display: none; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; }
        .rank-title { font-size: 1.8rem; color: #ffd700; margin-bottom: 15px; letter-spacing: 2px; }
        .final-score { font-size: 1.1rem; margin-bottom: 20px; color: #8d6e63; }
        
        .result-btns { display: flex; flex-direction: column; gap: 12px; width: 100%; max-width: 280px; }

        /* 5. 媒体查询：针对屏幕宽度小于 600px 的手机 */
        @media (max-width: 600px) {
            .choices-grid { grid-template-columns: 1fr; } /* 按钮变为单列，更易点击 */
            .text-panel { font-size: 0.95rem; padding: 12px; }
            h1 { font-size: 1.2rem; }
            button { padding: 15px 10px; font-size: 0.95rem; } /* 增大点击区域 */
        }

        /* 结案彩蛋按钮 */
        .comic-btn { background: #5d4037; border-color: #ffd700; color: #ffd700; font-weight: bold; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div id="game-container">
    <h1 id="main-title">红发会</h1>
    
    <div class="status-bar" id="stats">
        <span>侦探：夏洛克·福尔摩斯</span>
        <span id="score-display">演绎值: 0 / 100</span>
    </div>

    <div id="content-wrapper">
        <div id="logic-zone">
            <div class="text-panel" id="desc">
                福尔摩斯划着一根火柴点燃烟斗，白色的烟雾在贝克街221B内升腾。面前的杰贝兹·威尔逊正在讲述那个怪诞的“红发会”招工经历。福尔摩斯必须从这些叙述中提取出常人无法察觉的真相。
            </div>
            <div class="choices-grid" id="choices">
                <button onclick="play(1, 'A')">观察威尔逊右手肌肉与袖口的印记</button>
                <button onclick="play(1, 'B')">静候叙述，随后询问他的家庭背景</button>
            </div>
        </div>

        <div id="result-page">
            <div class="rank-title" id="rank-name">演绎等级</div>
            <div class="final-score" id="final-score-val">最终得分：0</div>
            <div class="text-panel" id="result-desc" style="width: 100%; text-align: left; font-size: 0.9rem;"></div>
            <div class="result-btns">
                <button class="comic-btn" onclick="openXhs()">查阅结案漫画彩蛋</button>
                <button onclick="location.reload()">重新演绎案件</button>
            </div>
        </div>
    </div>
</div>

<script>
    let score = 0;

    const story = {
        1: {
            A: { txt: "“威尔逊先生，你曾从事繁重的体力劳动。”福尔摩斯吐出一口烟。对方惊愕地看着自己那只异常粗壮的右手。福尔摩斯的判断准确无误，他开始关注那位“勤快”的助手斯波尔丁。", next: 2, pts: 25 },
            B: { txt: "谈话持续了很久。福尔摩斯虽然掌握了基本情况，但错过了一个直接震撼对方并掌握主动权的机会。线索依然零散，他决定带华生实地走一趟。", next: 2, pts: 10 }
        },
        2: {
            A: { txt: "福尔摩斯在萨克斯-科堡广场。他在当铺前用手杖敲击铺路石，回声坚实；随后他扫过助手的膝盖——那里布满了新鲜泥土与跪地劳作的磨损。", next: 3, pts: 25 },
            B: { txt: "福尔摩斯在广场周围漫步。他察觉到了助手的警觉，但没有捕捉到关键物理细节。虽然他推断地下室有蹊跷，但缺乏决定性证据。", next: 3, pts: 15 }
        },
        3: {
            A: { txt: "深夜，福尔摩斯潜入金库。他熄灭了提灯，在黑暗中静候。地板下方传来了轻微撬动声。他意识到，红发会的骗局只是为了支开主人，目标是银行黄金。", next: 4, pts: 25 },
            B: { txt: "福尔摩斯在红发会办公室守候，却毫无动静。直到清晨他才发现由于地理判断偏差，他们守错了地点，幸而在最后一刻赶往了银行。", next: 4, pts: 10 }
        },
        4: {
            A: { txt: "地板被凿穿，约翰·克莱现身。福尔摩斯猛地跳出，用左轮手枪指向对方眉心。罪犯脸上写满绝望，银行黄金保住了。案件告破。", next: 'finish', pts: 25 },
            B: { txt: "福尔摩斯等罪犯完全进入包围圈后再行动。但这给了克莱拔枪机会，现场陷入混乱。虽最终制服罪犯，但这一举动并不完美。", next: 'finish', pts: 15 }
        }
    };

    function play(nodeId, opt) {
        const node = story[nodeId][opt];
        score += node.pts;
        document.getElementById('score-display').innerText = `演绎值: ${score} / 100`;

        if (node.next === 'finish') {
            showResult();
        } else {
            document.getElementById('desc').innerHTML = `<b>福尔摩斯的推断：</b><br>${node.txt}`;
            updateButtons(node.next);
        }
    }

    function updateButtons(nextId) {
        const zone = document.getElementById('choices');
        if (nextId === 2) {
            zone.innerHTML = `<button onclick="play(2, 'A')">实地考察：敲击路面观察助手膝盖</button><button onclick="play(2, 'B')">周边调查：走访街区邻居了解情况</button>`;
        } else if (nextId === 3) {
            zone.innerHTML = `<button onclick="play(3, 'A')">果断设伏：潜入银行金库实施伏击</button><button onclick="play(3, 'B')">外围守候：在办公室旧址蹲点</button>`;
        } else if (nextId === 4) {
            zone.innerHTML = `<button onclick="play(4, 'A')">雷霆收网：在露头瞬间实施抓捕</button><button onclick="play(4, 'B')">稳健收网：等其完全脱离地道围捕</button>`;
        }
    }

    function showResult() {
        document.getElementById('logic-zone').style.display = 'none';
        const resPage = document.getElementById('result-page');
        resPage.style.display = 'flex';
        document.getElementById('final-score-val').innerText = `最终得分：${score} / 100`;

        if (score >= 100) {
            document.getElementById('rank-name').innerText = "贝克街之魂";
            document.getElementById('result-desc').innerHTML = "“完美，华生！”福尔摩斯总结道，“每一个细节都被精准捕捉。这抓住了伦敦最危险的罪犯。这绝对是你探案集中最精彩的案例之一。”";
        } else if (score >= 70) {
            document.getElementById('rank-name').innerText = "称职的侦探";
            document.getElementById('result-desc').innerHTML = "“案件虽然告破，但我们走了一些弯路。”福尔摩斯沉思道，“在这个行当里，没有微不足道的小事。”";
        } else {
            document.getElementById('rank-name').innerText = "苏格兰场水平";
            document.getElementById('result-desc').innerHTML = "“遗憾，华生。由于我们的迟疑，差点让约翰·克莱逃脱。这是一个值得深刻吸取的教训。”";
        }
    }

    function openXhs() {
        // 跳转到指定的小红书链接
        window.open('https://www.xiaohongshu.com/explore/6972e8e90000000022021498?xsec_token=AB8KG7iQP_J9Lts6IMzHJcxPINxcCxUt7a6LCuyH5m0Yo=&xsec_source=pc_user', '_blank');
    }
</script>
</body>
</html>